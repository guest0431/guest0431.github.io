(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[607],{4621:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/parthenon",function(){return n(9666)}])},9666:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var a=n(5893),s=n(9008),o=n(7294),r=n(8562),c=n.n(r),i=n(2474),u=n.n(i),l=n(1876).Buffer,p="RUNNING",d="TERMINATED",f=n(1876).Buffer;function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _,v,g,m="parthenon_server_data",S=(h(_={},d,"OFFLINE"),h(_,p,"ONLINE"),_),j=(h(v={},d,c().statusRed),h(v,p,c().statusGreen),v),x=(h(g={},d,"START"),h(g,p,"STOP"),g),b=function(e){var t=e.onReceivedServerData,n=(0,o.useState)(""),s=n[0],r=n[1],i=(0,o.useState)(""),u=i[0],l=i[1];return(0,a.jsxs)(o.Fragment,{children:[(0,a.jsx)("label",{children:"Server data"}),(0,a.jsx)("textarea",{className:c().serverData,onChange:function(e){return r(e.target.value)}}),(0,a.jsx)("p",{className:c().error,children:u}),(0,a.jsx)("button",{className:c().submit,type:"button",onClick:function(){try{var e=JSON.parse(f.from(s,"base64").toString());t(e)}catch(n){l("invalid server data")}},children:"ACCESS"})]})},N=function(){var e=(0,o.useState)(null),t=e[0],n=e[1],s=(0,o.useState)(""),r=s[0],i=s[1],h=(0,o.useState)(null),_=h[0],v=h[1],g=(0,o.useState)(new Date),N=g[0],w=g[1],y=(null===_||void 0===_?void 0:_.status)===p||(null===_||void 0===_?void 0:_.status)===d,T=(0,o.useCallback)((function(){""!==r&&null!==t&&(v(null),function(e,t,n){var a="https://compute.googleapis.com/compute/v1/projects/".concat(e.project,"/zones/").concat(e.zone,"/instances/").concat(e.resourceId),s=new XMLHttpRequest;s.open("GET",a),s.setRequestHeader("Authorization","Bearer ".concat(t)),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e=JSON.parse(s.responseText),t={status:e.status,ip:"unknown"};for(var a in e.networkInterfaces)for(var o in e.networkInterfaces[a].accessConfigs)t.ip=e.networkInterfaces[a].accessConfigs[o].natIP;n(t)}},s.send()}(t,r,(function(e){v(e),w(new Date)})))}),[r,t,v,w]);if((0,o.useEffect)((function(){var e=localStorage.getItem(m);if(null!==e)try{n(JSON.parse(f.from(e,"base64").toString()))}catch(t){console.error(t),localStorage.removeItem(m)}}),[]),(0,o.useEffect)((function(){null!==t&&function(e,t){var n=Math.floor((new Date).getTime()/1e3),a={iss:e.email,scope:"https://www.googleapis.com/auth/compute",aud:"https://oauth2.googleapis.com/token",exp:n+600,iat:n},s=l.from(JSON.stringify({alg:"RS256",typ:"JWT"})).toString("base64"),o=l.from(JSON.stringify(a)).toString("base64"),r=[s,o].join("."),c=[s,o,u().createSign("RSA-SHA256").update(r).sign(e.privateKey,"base64")].join("."),i=new FormData;i.append("grant_type","urn:ietf:params:oauth:grant-type:jwt-bearer"),i.append("assertion",c);var p=new XMLHttpRequest;p.open("POST","https://oauth2.googleapis.com/token"),p.onreadystatechange=function(){if(4==p.readyState&&200==p.status){var e=JSON.parse(p.responseText);t(e.access_token)}},p.send(i)}(t,i)}),[t]),(0,o.useEffect)(T,[r]),(0,o.useEffect)((function(){var e=(null===_||void 0===_?void 0:_.status)===p||(null===_||void 0===_?void 0:_.status)===d?1e4:1e3,n=setInterval((function(){""!==r&&null!==t&&T()}),e);return function(){return clearInterval(n)}}),[r,t,_]),null===t){return(0,a.jsx)(b,{onReceivedServerData:function(e){localStorage.setItem(m,f.from(JSON.stringify(e)).toString("base64")),n(e)}})}var k=[c().submit];return(null===_||void 0===_?void 0:_.status)===p?k.push(c().red):(null===_||void 0===_?void 0:_.status)===d?k.push(c().green):k.push(c().disabled),(0,a.jsxs)(o.Fragment,{children:[(0,a.jsxs)("h1",{children:["Parthenon ",(0,a.jsx)("i",{className:"".concat(c().delete," lni lni-trash-can"),onClick:function(){return n(null)}})," "]}),(0,a.jsxs)("div",{children:["IP: ",_?_.ip:" "]}),(0,a.jsxs)("div",{className:c().status,children:["STATUS: ",(0,a.jsx)("span",{className:!!_&&j[_.status]||"",children:_?S[_.status]||_.status:"Checking status..."}),(0,a.jsx)("button",{className:"".concat(c().reload," ").concat(y?c().loading:""),type:"button",onClick:T,children:(0,a.jsx)("i",{className:"".concat(y?" ":c().loading," lni lni-reload reload")})})]}),(0,a.jsxs)("p",{children:["Last updated: ",N.toLocaleDateString()+" "+N.toLocaleTimeString()]}),(0,a.jsx)("button",{className:"".concat(k.join(" ")),type:"button",disabled:!y,onClick:function(){v(null),(null===_||void 0===_?void 0:_.status)===d?function(e,t,n){var a="https://compute.googleapis.com/compute/v1/projects/".concat(e.project,"/zones/").concat(e.zone,"/instances/").concat(e.resourceId,"/start"),s=new XMLHttpRequest;s.open("POST",a),s.setRequestHeader("Authorization","Bearer ".concat(t)),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&setTimeout(n,1e3)},s.send()}(t,r,T):(null===_||void 0===_?void 0:_.status)===p&&function(e,t,n){var a="https://compute.googleapis.com/compute/v1/projects/".concat(e.project,"/zones/").concat(e.zone,"/instances/").concat(e.resourceId,"/stop"),s=new XMLHttpRequest;s.open("POST",a),s.setRequestHeader("Authorization","Bearer ".concat(t)),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&setTimeout(n,1e3)},s.send()}(t,r,T)},children:_?x[_.status]||_.status:"START"})]})},w=function(){return(0,a.jsxs)("div",{className:c().parthenon,children:[(0,a.jsxs)(s.default,{children:[(0,a.jsx)("title",{children:"Parthenon"}),(0,a.jsx)("link",{rel:"icon",type:"image/x-icon",href:"/assets/favicon-32.ico"}),(0,a.jsx)("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),(0,a.jsx)("link",{rel:"preconnect",href:"https://fonts.gstatic.com"}),(0,a.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap",rel:"stylesheet"})]}),(0,a.jsx)("div",{className:c().box,children:(0,a.jsx)(N,{})})]})}},8562:function(e){e.exports={parthenon:"parthenon_parthenon__lv7Uo",box:"parthenon_box__SV5BW",serverData:"parthenon_serverData__V673G",delete:"parthenon_delete__n28o9",status:"parthenon_status__XjU_d",reload:"parthenon_reload__JYxVH",loading:"parthenon_loading__Bt7ER",rotation:"parthenon_rotation__w_Ie2",statusGreen:"parthenon_statusGreen__p6jm1",statusRed:"parthenon_statusRed__EvlRP",error:"parthenon_error__QmCFT",submit:"parthenon_submit__TK7iD",green:"parthenon_green__Ir78_",red:"parthenon_red__hi7zV",disabled:"parthenon_disabled__OZ4n7"}}},function(e){e.O(0,[714,969,774,888,179],(function(){return t=4621,e(e.s=t);var t}));var t=e.O();_N_E=t}]);